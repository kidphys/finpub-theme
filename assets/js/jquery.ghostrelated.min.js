!function(t){function e(e,n){this.element=e,this.options=t.extend({},defaults,n),this.parseRss()}defaults={feed:"/rss",titleClass:".post-title",tagsClass:".post-meta",limit:5,debug:!1},e.prototype.displayRelated=function(e){var n=this,r=0;this._currentPostTags=this.getCurrentPostTags(this.options.tagsClass);var s=this.matchByTag(this._currentPostTags,e),i="",o=[];s.forEach(function(e){if(r<n.options.limit){i=e.image?'<a class="entry-media" href="'+e.url+'" style="background-image:url('+e.image+');" rel="bookmark"></a>':"";for(index in e.tags)o[index]='<a href="/tag/'+e.tags[index]+'">'+e.tags[index]+"</a>";t(n.element).append(t('<div class="col-md-4 related-post">'+i+'<h4 class="entry-title"><a href="'+e.url+'">'+e.title+'</a></h4><div class="entry-meta"><span class="cat-links">'+o.join(" ")+"</span></div></div>"))}r++})},e.prototype.parseRss=function(e,n,r){var s=e||1,n=n||"",r=r||[],i=this;t.ajax({url:this.options.feed+"/"+s,type:"GET"}).done(function(e){var o=t(e).find("item > guid").text();if(o!=n)r.push(e),i.parseRss(s+1,o,r);else{var a=i.getPosts(r);i.displayRelated(a)}}).fail(function(t){i.reportError(t)})},e.prototype.getCurrentPostTitle=function(e){"."!=e[0]&&(e="."+e);var n=t(e).text();return n.length<1&&this.reportError("Couldn't find the post title with class: "+e),n},e.prototype.getCurrentPostTags=function(e){"."!=e[0]&&(e="."+e);var n=[];return t(e+" a").each(function(){n.push(t(this).text())}),n.length<1&&this.reportError("Couldn't find any tags in this post"),n},e.prototype.getPosts=function(e){var n=[],r=[];e.forEach(function(e){r=t.merge(r,t(e).find("item"))});for(var s=0;s<r.length;s++){var i=t(r[s]);i.find("title").text()!==this.getCurrentPostTitle(this.options.titleClass)&&n.push({title:i.find("title").text(),url:i.find("link").text(),content:i.find("description").text(),image:i.find("media\\:content, content").attr("url"),tags:t.map(i.find("category"),function(e){return t(e).text()})})}return n.length<1&&this.reportError("Couldn't find any posts in feed: "+feed),n},e.prototype.matchByTag=function(t,e){var n=[];return e.forEach(function(e){var r=!1;e.tags.forEach(function(s){t.forEach(function(t){t.toLowerCase()!==s.toLowerCase()||r||(n.push(e),r=!0)})})}),n.length<1&&this.reportError("There are no closely related posts"),n},e.prototype.reportError=function(e){this.options.debug&&t(this.element).append(t("<li>"+e+"</li>"))},t.fn.ghostRelated=function(t){return this.each(function(){new e(this,t)})}}(jQuery);